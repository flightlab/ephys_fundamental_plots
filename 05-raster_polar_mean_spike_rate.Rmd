# Raster and mean spike rate plots

## Data sets

This section will rely on some of the unbinned and binned data we exported in 
final steps of the previous section. We'll start by loading in information

```{r plotting_data_sets, message=FALSE, warning=FALSE}
## File paths and basenames of _unbinned.csv files
unbinned_filelist <-
  list.files("./data/", pattern = "_unbinned.csv",
             full.names = TRUE)
unbinned_basenames <-
  unbinned_filelist %>%
  str_remove("./data/") %>%
  str_remove("_unbinned.csv")

## File paths and basenames of _binsize10.csv files
bin10_filelist <-
  list.files("./data/", pattern = "_binsize10.csv",
             full.names = TRUE)
bin10_basenames <-
  bin10_filelist %>%
  str_remove("./data/") %>%
  str_remove("_binsize10.csv")

## File paths and basenames of _binsize100.csv files
bin100_filelist <-
  list.files("./data/", pattern = "_binsize100.csv",
             full.names = TRUE)
bin100_basenames <-
  bin100_filelist %>%
  str_remove("./data/") %>%
  str_remove("_binsize100.csv")
```

You should have something similar to the following:

```{r confirm_data_paths}
unbinned_filelist; unbinned_basenames; bin10_filelist; bin10_basenames; bin100_filelist; bin100_basenames
```


## Raster plot

Here is an example of a raster plot, using the wrangled data generated in the
previous section. This type of plot shows the timing of spike events within
each replicate sweep, and for our purposes, we'll produce a view of this for
each of the various stimulus conditions

It is important to note that we will need unbinned data for this. This is
because a raster plot shows discrete spiking events through the course of a time
sweep.

```{r raster_plot}
## Read in unbinned data
unbinned_data <-
  read_csv(unbinned_filelist[1], show_col_types = FALSE) %>%
  as_tibble()

## determine the max number of replicates
max_reps <- max(unbinned_data$Replicate)

## Generate the code for the ggplot and save it as "rasterplot"
rasterplot <-
  unbinned_data %>%
  ## Remove any rows where spiking does not occur in the Spikes column
  filter(Spikes == 1) %>%
  ## Convert Trial and Speed into factors and specify their level ordering
  ## This will make it easier to get the subplots in the order we want them
  mutate(
    Trial = factor(Trial,
                   levels = c("blank", "stationary", "moving")),
    Speed = factor(Speed,
                   levels = c(1024, 644, 407, 256, 128, 64, 32, 16, 8, 4))) %>%
  ggplot(aes(x = Time_stand, y = Replicate)) +
  ## The next three blocks will undershade each subplot according to stimulus
  ## phase (i.e., blank, stationary, moving)
  annotate("rect",
           xmin = 0, xmax = first(unbinned_data$Blank_end),
           ymin = 0.5, ymax = max_reps + 0.5,
           alpha = 0.1, color = NA, fill = "red") +
  annotate("rect",
           xmin = first(unbinned_data$Blank_end),
           xmax = first(unbinned_data$Static_end),
           ymin = 0.5, ymax = max_reps + 0.5,
           alpha = 0.1, color = NA, fill = "darkgoldenrod1") +
  annotate("rect",
           xmin = first(unbinned_data$Static_end), xmax = 5,
           ymin = 0.5, ymax = max_reps + 0.5,
           alpha = 0.1, color = NA, fill = "forestgreen") +
  ## Up to 10 replicates were used, so we will force the y-axis to go to 10
  scale_y_continuous(
    limits = c(0.5, max_reps + 0.5),
    expand = c(0, 0),
    breaks = c(max_reps/2, max_reps)
  ) +
  ## There are multiple ways to plot a spike event. Since 100% of the rows in
  ## this filtered data set are spike events, we can simply plot a symbol at
  ## each time (Time_stand) that appears in the data. The `|` symbol is a good
  ## choice.
  geom_point(pch = '|', size = 1.5) +
  xlab("Time (sec)") +
  ggtitle(paste0(unbinned_basenames[1], " raster")) +
  ## Use facet_grid() to create a grid of subplots. Rows will correspond to
  ## Speeds, and columns correspond to Directions
  facet_grid(rows = vars(Speed), cols = vars(Direction)) +
  theme_classic() +
  theme(legend.position = 'none',
        panel.spacing = unit(0.1, "lines"))

rasterplot
```

### Export to PDF

Should you elect to export this plot by itself to a `PDF`, you can do the
following:

```{r export_raster_pdf, eval=F, echo=T}
## Should you elect to export this as a PDF
pdf(
  file = "./path/to/directory/filename.pdf",
  width = 10.5,
  height = 8,
  title = "04132022_009m raster",
  paper = "USr",
  bg = "white",
  pagecentre = TRUE,
  colormodel = "srgb"
)
plot(rasterplot)
dev.off()
```


## Mean spike rate plots


