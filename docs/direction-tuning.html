<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Direction tuning | Fundamental plots for electrophysiological data</title>
  <meta name="description" content="<p>A walkthrough on how to produce fundamental plots from electrophysiological
data. Developed by the Alshuler Lab at the University of British Columbia.</p>" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Direction tuning | Fundamental plots for electrophysiological data" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>A walkthrough on how to produce fundamental plots from electrophysiological
data. Developed by the Alshuler Lab at the University of British Columbia.</p>" />
  <meta name="github-repo" content="flightlab/ephys_fundamental_plots" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Direction tuning | Fundamental plots for electrophysiological data" />
  
  <meta name="twitter:description" content="<p>A walkthrough on how to produce fundamental plots from electrophysiological
data. Developed by the Alshuler Lab at the University of British Columbia.</p>" />
  

<meta name="author" content="Vikram B. Baliga" />


<meta name="date" content="2023-03-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="raster-and-mean-spike-rate-plots.html"/>
<link rel="next" href="spatiotemporal-tuning.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Fundamental plots for electrophysiological data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>2</b> Preface</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preface.html"><a href="preface.html#r-packages-versioning"><i class="fa fa-check"></i><b>2.1</b> R packages &amp; versioning</a></li>
<li class="chapter" data-level="2.2" data-path="preface.html"><a href="preface.html#not_in"><i class="fa fa-check"></i><b>2.2</b> <code>%not_in%</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="spike-sorting.html"><a href="spike-sorting.html"><i class="fa fa-check"></i><b>3</b> Spike sorting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="spike-sorting.html"><a href="spike-sorting.html#spike2"><i class="fa fa-check"></i><b>3.1</b> Spike2</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="spike-sorting.html"><a href="spike-sorting.html#file-naming-conventions"><i class="fa fa-check"></i><b>3.1.1</b> File naming conventions:</a></li>
<li class="chapter" data-level="3.1.2" data-path="spike-sorting.html"><a href="spike-sorting.html#spike-sorting-with-spike2"><i class="fa fa-check"></i><b>3.1.2</b> Spike sorting with Spike2</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="spike-sorting.html"><a href="spike-sorting.html#neuralynx"><i class="fa fa-check"></i><b>3.2</b> Neuralynx</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="quick-version---condensed-plots.html"><a href="quick-version---condensed-plots.html"><i class="fa fa-check"></i><b>4</b> Quick version - condensed plots</a></li>
<li class="chapter" data-level="5" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>5</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-wrangling.html"><a href="data-wrangling.html#import-example-file-and-metadata"><i class="fa fa-check"></i><b>5.1</b> Import example file and metadata</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#identify-files-to-import"><i class="fa fa-check"></i><b>5.1.1</b> Identify files to import</a></li>
<li class="chapter" data-level="5.1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#data-import-and-preliminary-labeling"><i class="fa fa-check"></i><b>5.1.2</b> Data import and preliminary labeling</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-wrangling.html"><a href="data-wrangling.html#organizing-replicates-required-and-binning-optional"><i class="fa fa-check"></i><b>5.2</b> Organizing replicates (required) and binning (optional)</a></li>
<li class="chapter" data-level="5.3" data-path="data-wrangling.html"><a href="data-wrangling.html#data-export"><i class="fa fa-check"></i><b>5.3</b> Data export</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="raster-and-mean-spike-rate-plots.html"><a href="raster-and-mean-spike-rate-plots.html"><i class="fa fa-check"></i><b>6</b> Raster and mean spike rate plots</a>
<ul>
<li class="chapter" data-level="6.1" data-path="raster-and-mean-spike-rate-plots.html"><a href="raster-and-mean-spike-rate-plots.html#data-sets"><i class="fa fa-check"></i><b>6.1</b> Data sets</a></li>
<li class="chapter" data-level="6.2" data-path="raster-and-mean-spike-rate-plots.html"><a href="raster-and-mean-spike-rate-plots.html#raster-plot"><i class="fa fa-check"></i><b>6.2</b> Raster plot</a></li>
<li class="chapter" data-level="6.3" data-path="raster-and-mean-spike-rate-plots.html"><a href="raster-and-mean-spike-rate-plots.html#mean-spike-rate-plots"><i class="fa fa-check"></i><b>6.3</b> Mean spike rate plots</a></li>
<li class="chapter" data-level="6.4" data-path="raster-and-mean-spike-rate-plots.html"><a href="raster-and-mean-spike-rate-plots.html#export-to-pdf"><i class="fa fa-check"></i><b>6.4</b> Export to PDF</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="direction-tuning.html"><a href="direction-tuning.html"><i class="fa fa-check"></i><b>7</b> Direction tuning</a>
<ul>
<li class="chapter" data-level="7.1" data-path="direction-tuning.html"><a href="direction-tuning.html#data-import-and-baseline-rate-measurement"><i class="fa fa-check"></i><b>7.1</b> Data import and baseline rate measurement</a></li>
<li class="chapter" data-level="7.2" data-path="direction-tuning.html"><a href="direction-tuning.html#using-the-full-3-sec-motion-epoch"><i class="fa fa-check"></i><b>7.2</b> Using the full 3-sec motion epoch</a></li>
<li class="chapter" data-level="7.3" data-path="direction-tuning.html"><a href="direction-tuning.html#using-40-200ms-initial-transient"><i class="fa fa-check"></i><b>7.3</b> Using 40-200ms (“initial transient”)</a></li>
<li class="chapter" data-level="7.4" data-path="direction-tuning.html"><a href="direction-tuning.html#using-1500-3000ms-steady-state"><i class="fa fa-check"></i><b>7.4</b> Using 1500-3000ms (“steady state”)</a></li>
<li class="chapter" data-level="7.5" data-path="direction-tuning.html"><a href="direction-tuning.html#using-0-500-ms-arbitrary-epoch-length"><i class="fa fa-check"></i><b>7.5</b> Using 0-500 ms (arbitrary epoch length)</a></li>
<li class="chapter" data-level="7.6" data-path="direction-tuning.html"><a href="direction-tuning.html#construct-a-multi-panel-plot"><i class="fa fa-check"></i><b>7.6</b> Construct a multi-panel plot</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatiotemporal-tuning.html"><a href="spatiotemporal-tuning.html"><i class="fa fa-check"></i><b>8</b> Spatiotemporal tuning</a></li>
<li class="chapter" data-level="9" data-path="raw-data-and-spike-sorted-traces.html"><a href="raw-data-and-spike-sorted-traces.html"><i class="fa fa-check"></i><b>9</b> Raw data and spike sorted traces</a></li>
<li class="chapter" data-level="10" data-path="histological-verification.html"><a href="histological-verification.html"><i class="fa fa-check"></i><b>10</b> Histological verification</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="histological-verification.html"><a href="histological-verification.html#direct-embedding-method"><i class="fa fa-check"></i><b>10.0.1</b> Direct embedding method:</a></li>
<li class="chapter" data-level="10.0.2" data-path="histological-verification.html"><a href="histological-verification.html#hotlinking-method"><i class="fa fa-check"></i><b>10.0.2</b> Hotlinking method:</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fundamental plots for electrophysiological data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="direction-tuning" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Direction tuning<a href="direction-tuning.html#direction-tuning" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This type of plot is so fundamental to the examination of LM and nBOR,
it deserves a chapter unto itself. The majority of the information
going into polar tuning plots is the same as those in previous
chapters. Unlike raster and mean spike rate plots, however, direction
tuning plots require deliberate choices from the investigator to
delineate a “baseline” spike rate to be distinguished from the spike
rate during the stimulus of interest (in our case, global motion
patterns). The conditions that define the baseline and motion epochs
require explicit definitions form the investigator.</p>
<p>Seeing the mean spike rate plot from the previous chapter will help
give context to some of these decisions <strong>[INSERT IMAGE HERE]</strong>.
Importantly, at the onset of the blank and the stationary phases, it
is common to observe an initial transient response – a sharp increase
in the spike rate of the neuron – followed by a return to a steady
state.</p>
<p>For our purposes, the baseline will be defined as the steady state
response during the stationary phase of the stimulus. We will collect
this steady state response rate across all stimulus conditions (i.e.,
varying combos of speed and direction), and will simply average all of
those response rates to attain our baseline rate (and its SEM). Please
note that it is up to the investigator to determine if this definition
is appropriate, especially if other stimulus presentations are being
used.</p>
<p>For the “motion epoch”, I will use a few different definitions. Some
of these conventions are informed by previous work (e.g., Smyth et al.
2022), whereas others are just based on a rough approximation of what
may be appropriate for these data. The definitions of the motion
epochs will be:</p>
<ol style="list-style-type: decimal">
<li>The entire 3-sec motion epoch</li>
<li>The “initial transient” phase: 40-200ms after the onset of
motion (as used in Smyth et al. 2022)</li>
<li>The “steady state” phase: 1500-3000ms after the onset of motion,
a.k.a., the second half of the motion stimulus (as used in Smyth
et al. 2022)</li>
<li>The first 500 ms of the motion phase. This is an arbitrary
definition for demonstrative purposes only, but somewhat informed
by observing the patterns in the mean spike rate plot</li>
</ol>
<p>As we construct polar plots, two additional aspects will be included
in the plots:</p>
<ol style="list-style-type: decimal">
<li>The “preferred direction” of the neuron, as defined by the vector
sum method <strong>[insert citation]</strong>. This will be shown as a single
grey line in the plot that indicates the preferred direction. Bear
in mind that this value may not always be meaningful, particularly
in cases of multi-modal responses.</li>
<li>The Sensitivity Index (SI) of the neuron, as defined by
<strong><a href="index.html#citation">citation</a></strong>. This metric calculates the narrowness of tuning.
An SI of 1 indicates strong response to a single direction whereas
0 indicates similar response across all investigated directions.</li>
</ol>
<div id="data-import-and-baseline-rate-measurement" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Data import and baseline rate measurement<a href="direction-tuning.html#data-import-and-baseline-rate-measurement" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will use the 10-ms binned data for these examples. We’ll read in the
file and then extract the baseline rate as defined above. The code will be
written such that it can batch-process more than one file if desired.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="direction-tuning.html#cb46-1" aria-hidden="true" tabindex="-1"></a>bin10_data <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb46-2"><a href="direction-tuning.html#cb46-2" aria-hidden="true" tabindex="-1"></a>polar_directions <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb46-3"><a href="direction-tuning.html#cb46-3" aria-hidden="true" tabindex="-1"></a>baseline_summary_df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb46-4"><a href="direction-tuning.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bin10_filelist)) {</span>
<span id="cb46-5"><a href="direction-tuning.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Read in the data</span></span>
<span id="cb46-6"><a href="direction-tuning.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  bin10_data[[i]] <span class="ot">&lt;-</span></span>
<span id="cb46-7"><a href="direction-tuning.html#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(bin10_filelist[i], <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="direction-tuning.html#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="direction-tuning.html#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Again, we will set Speed as an ordered factor to help control plotting</span></span>
<span id="cb46-10"><a href="direction-tuning.html#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">## later on</span></span>
<span id="cb46-11"><a href="direction-tuning.html#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb46-12"><a href="direction-tuning.html#cb46-12" aria-hidden="true" tabindex="-1"></a>      Speed,</span>
<span id="cb46-13"><a href="direction-tuning.html#cb46-13" aria-hidden="true" tabindex="-1"></a>      factor,</span>
<span id="cb46-14"><a href="direction-tuning.html#cb46-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;4&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;64&quot;</span>, <span class="st">&quot;128&quot;</span>, <span class="st">&quot;256&quot;</span>, <span class="st">&quot;407&quot;</span>, <span class="st">&quot;644&quot;</span>, <span class="st">&quot;1024&quot;</span>)</span>
<span id="cb46-15"><a href="direction-tuning.html#cb46-15" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb46-16"><a href="direction-tuning.html#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="direction-tuning.html#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Determine unique directions</span></span>
<span id="cb46-18"><a href="direction-tuning.html#cb46-18" aria-hidden="true" tabindex="-1"></a>  polar_directions[[i]] <span class="ot">&lt;-</span></span>
<span id="cb46-19"><a href="direction-tuning.html#cb46-19" aria-hidden="true" tabindex="-1"></a>    bin10_data[[i]]<span class="sc">$</span>Direction <span class="sc">%&gt;%</span></span>
<span id="cb46-20"><a href="direction-tuning.html#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb46-21"><a href="direction-tuning.html#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="direction-tuning.html#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extract all rows corresponding to our desired baseline epoch</span></span>
<span id="cb46-23"><a href="direction-tuning.html#cb46-23" aria-hidden="true" tabindex="-1"></a>  baseline_df <span class="ot">&lt;-</span></span>
<span id="cb46-24"><a href="direction-tuning.html#cb46-24" aria-hidden="true" tabindex="-1"></a>    bin10_data[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb46-25"><a href="direction-tuning.html#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&gt;=</span> Blank_end <span class="sc">+</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span> <span class="do">## 0.5 sec after blank end</span></span>
<span id="cb46-26"><a href="direction-tuning.html#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&lt;=</span> Static_end <span class="sc">-</span> <span class="fl">0.05</span>)   <span class="do">## 0.05 sec before static end</span></span>
<span id="cb46-27"><a href="direction-tuning.html#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="direction-tuning.html#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Compute the mean baseline</span></span>
<span id="cb46-29"><a href="direction-tuning.html#cb46-29" aria-hidden="true" tabindex="-1"></a>  global_base <span class="ot">&lt;-</span> <span class="fu">mean</span>(baseline_df<span class="sc">$</span>Spike_rate)</span>
<span id="cb46-30"><a href="direction-tuning.html#cb46-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Compute the SE</span></span>
<span id="cb46-31"><a href="direction-tuning.html#cb46-31" aria-hidden="true" tabindex="-1"></a>  global_base_se <span class="ot">&lt;-</span></span>
<span id="cb46-32"><a href="direction-tuning.html#cb46-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(baseline_df<span class="sc">$</span>Spike_rate) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(baseline_df<span class="sc">$</span>Spike_rate)</span>
<span id="cb46-33"><a href="direction-tuning.html#cb46-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-34"><a href="direction-tuning.html#cb46-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-35"><a href="direction-tuning.html#cb46-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Construct a summary data frame</span></span>
<span id="cb46-36"><a href="direction-tuning.html#cb46-36" aria-hidden="true" tabindex="-1"></a>  baseline_summary_df[[i]] <span class="ot">&lt;-</span></span>
<span id="cb46-37"><a href="direction-tuning.html#cb46-37" aria-hidden="true" tabindex="-1"></a>    baseline_df <span class="sc">%&gt;%</span></span>
<span id="cb46-38"><a href="direction-tuning.html#cb46-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb46-39"><a href="direction-tuning.html#cb46-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb46-40"><a href="direction-tuning.html#cb46-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">speed_specific_baseline =</span> <span class="fu">mean</span>(Spike_rate),</span>
<span id="cb46-41"><a href="direction-tuning.html#cb46-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">speed_specific_baseline_se =</span> <span class="fu">sd</span>(Spike_rate)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(Spike_rate)),</span>
<span id="cb46-42"><a href="direction-tuning.html#cb46-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">global_baseline =</span> global_base,</span>
<span id="cb46-43"><a href="direction-tuning.html#cb46-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">global_baseline_se =</span> global_base_se</span>
<span id="cb46-44"><a href="direction-tuning.html#cb46-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-45"><a href="direction-tuning.html#cb46-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-46"><a href="direction-tuning.html#cb46-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This tibble contains speed-specific baselines (and SE) along with the</span></span>
<span id="cb46-47"><a href="direction-tuning.html#cb46-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">## global mean baseline (and SE)</span></span>
<span id="cb46-48"><a href="direction-tuning.html#cb46-48" aria-hidden="true" tabindex="-1"></a>  baseline_summary_df[[i]]</span>
<span id="cb46-49"><a href="direction-tuning.html#cb46-49" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="using-the-full-3-sec-motion-epoch" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Using the full 3-sec motion epoch<a href="direction-tuning.html#using-the-full-3-sec-motion-epoch" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This will be referred to as the “naive” approach in the code below</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="direction-tuning.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## global baseline values, full 3-sec motion period</span></span>
<span id="cb47-2"><a href="direction-tuning.html#cb47-2" aria-hidden="true" tabindex="-1"></a>bin10_polar_naive <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb47-3"><a href="direction-tuning.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bin10_filelist)) {</span>
<span id="cb47-4"><a href="direction-tuning.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  naive_df  <span class="ot">&lt;-</span></span>
<span id="cb47-5"><a href="direction-tuning.html#cb47-5" aria-hidden="true" tabindex="-1"></a>    bin10_data[[i]]  <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="direction-tuning.html#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&gt;</span> Static_end) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="direction-tuning.html#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed, Direction, Replicate) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="direction-tuning.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb47-9"><a href="direction-tuning.html#cb47-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(Spike_rate)</span>
<span id="cb47-10"><a href="direction-tuning.html#cb47-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-11"><a href="direction-tuning.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  naive_360 <span class="ot">&lt;-</span></span>
<span id="cb47-12"><a href="direction-tuning.html#cb47-12" aria-hidden="true" tabindex="-1"></a>    naive_df <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="direction-tuning.html#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Direction <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-14"><a href="direction-tuning.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb47-15"><a href="direction-tuning.html#cb47-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> Speed,</span>
<span id="cb47-16"><a href="direction-tuning.html#cb47-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Direction =</span> <span class="dv">360</span>,</span>
<span id="cb47-17"><a href="direction-tuning.html#cb47-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">Replicate =</span> Replicate,</span>
<span id="cb47-18"><a href="direction-tuning.html#cb47-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> mean_spike_rate)</span>
<span id="cb47-19"><a href="direction-tuning.html#cb47-19" aria-hidden="true" tabindex="-1"></a>  naive_vecsum_df <span class="ot">&lt;-</span></span>
<span id="cb47-20"><a href="direction-tuning.html#cb47-20" aria-hidden="true" tabindex="-1"></a>    naive_df <span class="sc">%&gt;%</span></span>
<span id="cb47-21"><a href="direction-tuning.html#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb47-22"><a href="direction-tuning.html#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb47-23"><a href="direction-tuning.html#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb47-24"><a href="direction-tuning.html#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb47-25"><a href="direction-tuning.html#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span><span class="al">NOTE</span><span class="do">: FOLLOWING THE JNP AND CB PAPERS, WE ARE SUBTRACTING BASELINE HERE AND</span></span>
<span id="cb47-26"><a href="direction-tuning.html#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="do">## THEN IF ANY AVERAGED FIRING RATES ARE NEGATIVE, THEY ARE SHIFTED SO THE</span></span>
<span id="cb47-27"><a href="direction-tuning.html#cb47-27" aria-hidden="true" tabindex="-1"></a>    <span class="do">## LOWEST ONE IS ZERO. THE GENERATED PLOTS STILL SHOW NON-BASELINE-SUBTRACTED</span></span>
<span id="cb47-28"><a href="direction-tuning.html#cb47-28" aria-hidden="true" tabindex="-1"></a>    <span class="do">## FIRING RATES (AND BASELINE AS A RED RING), BUT COMPUTATION OF VECTOR SUM</span></span>
<span id="cb47-29"><a href="direction-tuning.html#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="do">## AND SI HAVE BEEN BASELINE SUBTRACTED (AND THE ENTIRE CURVE IS SHIFTED</span></span>
<span id="cb47-30"><a href="direction-tuning.html#cb47-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">## UPWARDS IF ANY PART IS NEGATIVE)</span></span>
<span id="cb47-31"><a href="direction-tuning.html#cb47-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(</span>
<span id="cb47-32"><a href="direction-tuning.html#cb47-32" aria-hidden="true" tabindex="-1"></a>      summarize,</span>
<span id="cb47-33"><a href="direction-tuning.html#cb47-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb47-34"><a href="direction-tuning.html#cb47-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb47-35"><a href="direction-tuning.html#cb47-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb47-36"><a href="direction-tuning.html#cb47-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb47-37"><a href="direction-tuning.html#cb47-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb47-38"><a href="direction-tuning.html#cb47-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(</span>
<span id="cb47-39"><a href="direction-tuning.html#cb47-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb47-40"><a href="direction-tuning.html#cb47-40" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate</span>
<span id="cb47-41"><a href="direction-tuning.html#cb47-41" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">%&gt;%</span></span>
<span id="cb47-42"><a href="direction-tuning.html#cb47-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(</span>
<span id="cb47-43"><a href="direction-tuning.html#cb47-43" aria-hidden="true" tabindex="-1"></a>      transmute,</span>
<span id="cb47-44"><a href="direction-tuning.html#cb47-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb47-45"><a href="direction-tuning.html#cb47-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb47-46"><a href="direction-tuning.html#cb47-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb47-47"><a href="direction-tuning.html#cb47-47" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb47-48"><a href="direction-tuning.html#cb47-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb47-49"><a href="direction-tuning.html#cb47-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">mean</span>(x),</span>
<span id="cb47-50"><a href="direction-tuning.html#cb47-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">mean</span>(y),</span>
<span id="cb47-51"><a href="direction-tuning.html#cb47-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb47-52"><a href="direction-tuning.html#cb47-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb47-53"><a href="direction-tuning.html#cb47-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">vector_sum =</span> (<span class="fu">atan2</span>(y, x) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi) <span class="sc">%%</span> <span class="dv">360</span>,</span>
<span id="cb47-54"><a href="direction-tuning.html#cb47-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb47-55"><a href="direction-tuning.html#cb47-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb47-56"><a href="direction-tuning.html#cb47-56" aria-hidden="true" tabindex="-1"></a>  naive_si_df <span class="ot">&lt;-</span></span>
<span id="cb47-57"><a href="direction-tuning.html#cb47-57" aria-hidden="true" tabindex="-1"></a>    naive_df <span class="sc">%&gt;%</span></span>
<span id="cb47-58"><a href="direction-tuning.html#cb47-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb47-59"><a href="direction-tuning.html#cb47-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb47-60"><a href="direction-tuning.html#cb47-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb47-61"><a href="direction-tuning.html#cb47-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb47-62"><a href="direction-tuning.html#cb47-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(</span>
<span id="cb47-63"><a href="direction-tuning.html#cb47-63" aria-hidden="true" tabindex="-1"></a>      summarize,</span>
<span id="cb47-64"><a href="direction-tuning.html#cb47-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb47-65"><a href="direction-tuning.html#cb47-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb47-66"><a href="direction-tuning.html#cb47-66" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb47-67"><a href="direction-tuning.html#cb47-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb47-68"><a href="direction-tuning.html#cb47-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb47-69"><a href="direction-tuning.html#cb47-69" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(</span>
<span id="cb47-70"><a href="direction-tuning.html#cb47-70" aria-hidden="true" tabindex="-1"></a>            <span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb47-71"><a href="direction-tuning.html#cb47-71" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate</span>
<span id="cb47-72"><a href="direction-tuning.html#cb47-72" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">%&gt;%</span></span>
<span id="cb47-73"><a href="direction-tuning.html#cb47-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(</span>
<span id="cb47-74"><a href="direction-tuning.html#cb47-74" aria-hidden="true" tabindex="-1"></a>      transmute,</span>
<span id="cb47-75"><a href="direction-tuning.html#cb47-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">a =</span> (<span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb47-76"><a href="direction-tuning.html#cb47-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">b =</span> (<span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb47-77"><a href="direction-tuning.html#cb47-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">c =</span> <span class="fu">mean</span>(mean_spike_rate),</span>
<span id="cb47-78"><a href="direction-tuning.html#cb47-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb47-79"><a href="direction-tuning.html#cb47-79" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb47-80"><a href="direction-tuning.html#cb47-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(</span>
<span id="cb47-81"><a href="direction-tuning.html#cb47-81" aria-hidden="true" tabindex="-1"></a>      summarise,</span>
<span id="cb47-82"><a href="direction-tuning.html#cb47-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">a =</span> <span class="fu">mean</span>(a),</span>
<span id="cb47-83"><a href="direction-tuning.html#cb47-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">b =</span> <span class="fu">mean</span>(b),</span>
<span id="cb47-84"><a href="direction-tuning.html#cb47-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">c =</span> <span class="fu">mean</span>(c),</span>
<span id="cb47-85"><a href="direction-tuning.html#cb47-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb47-86"><a href="direction-tuning.html#cb47-86" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb47-87"><a href="direction-tuning.html#cb47-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb47-88"><a href="direction-tuning.html#cb47-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">si =</span> <span class="fu">sqrt</span>(a <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> b <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> c,</span>
<span id="cb47-89"><a href="direction-tuning.html#cb47-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb47-90"><a href="direction-tuning.html#cb47-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb47-91"><a href="direction-tuning.html#cb47-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-92"><a href="direction-tuning.html#cb47-92" aria-hidden="true" tabindex="-1"></a>  naive_data <span class="ot">&lt;-</span></span>
<span id="cb47-93"><a href="direction-tuning.html#cb47-93" aria-hidden="true" tabindex="-1"></a>    naive_df <span class="sc">%&gt;%</span></span>
<span id="cb47-94"><a href="direction-tuning.html#cb47-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(naive_360) <span class="sc">%&gt;%</span></span>
<span id="cb47-95"><a href="direction-tuning.html#cb47-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(naive_vecsum_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-96"><a href="direction-tuning.html#cb47-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(naive_si_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-97"><a href="direction-tuning.html#cb47-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate)</span>
<span id="cb47-98"><a href="direction-tuning.html#cb47-98" aria-hidden="true" tabindex="-1"></a>  naive_max_y <span class="ot">&lt;-</span> <span class="fu">max</span>(naive_data<span class="sc">$</span>mean_spike_rate)</span>
<span id="cb47-99"><a href="direction-tuning.html#cb47-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-100"><a href="direction-tuning.html#cb47-100" aria-hidden="true" tabindex="-1"></a>  bin10_polar_naive[[i]] <span class="ot">&lt;-</span></span>
<span id="cb47-101"><a href="direction-tuning.html#cb47-101" aria-hidden="true" tabindex="-1"></a>    naive_data <span class="sc">%&gt;%</span></span>
<span id="cb47-102"><a href="direction-tuning.html#cb47-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(baseline_summary_df[[i]], <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-103"><a href="direction-tuning.html#cb47-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Direction, <span class="at">y =</span> mean_spike_rate)) <span class="sc">+</span></span>
<span id="cb47-104"><a href="direction-tuning.html#cb47-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(</span>
<span id="cb47-105"><a href="direction-tuning.html#cb47-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Direction,</span>
<span id="cb47-106"><a href="direction-tuning.html#cb47-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> global_baseline <span class="sc">-</span> global_baseline_se,</span>
<span id="cb47-107"><a href="direction-tuning.html#cb47-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> global_baseline <span class="sc">+</span> global_baseline_se</span>
<span id="cb47-108"><a href="direction-tuning.html#cb47-108" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb47-109"><a href="direction-tuning.html#cb47-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;darkgoldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-110"><a href="direction-tuning.html#cb47-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb47-111"><a href="direction-tuning.html#cb47-111" aria-hidden="true" tabindex="-1"></a>                <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="fu">length</span>(polar_directions[[i]])),</span>
<span id="cb47-112"><a href="direction-tuning.html#cb47-112" aria-hidden="true" tabindex="-1"></a>                <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-113"><a href="direction-tuning.html#cb47-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#333132&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-114"><a href="direction-tuning.html#cb47-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(si, <span class="dv">2</span>) , <span class="at">x =</span> <span class="dv">315</span>, <span class="at">y =</span> naive_max_y <span class="sc">*</span> <span class="fl">1.2</span>),</span>
<span id="cb47-115"><a href="direction-tuning.html#cb47-115" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb47-116"><a href="direction-tuning.html#cb47-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> vector_sum), <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>,</span>
<span id="cb47-117"><a href="direction-tuning.html#cb47-117" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb47-118"><a href="direction-tuning.html#cb47-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="at">direction =</span> <span class="dv">1</span>, <span class="at">start =</span> pi <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-119"><a href="direction-tuning.html#cb47-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb47-120"><a href="direction-tuning.html#cb47-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="dv">270</span>),</span>
<span id="cb47-121"><a href="direction-tuning.html#cb47-121" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb47-122"><a href="direction-tuning.html#cb47-122" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">360</span>)</span>
<span id="cb47-123"><a href="direction-tuning.html#cb47-123" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb47-124"><a href="direction-tuning.html#cb47-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb47-125"><a href="direction-tuning.html#cb47-125" aria-hidden="true" tabindex="-1"></a>      <span class="co">#trans = &quot;sqrt&quot;,</span></span>
<span id="cb47-126"><a href="direction-tuning.html#cb47-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, naive_max_y <span class="sc">*</span> <span class="fl">1.2</span>)</span>
<span id="cb47-127"><a href="direction-tuning.html#cb47-127" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb47-128"><a href="direction-tuning.html#cb47-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Speed)) <span class="sc">+</span></span>
<span id="cb47-129"><a href="direction-tuning.html#cb47-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Full 3-sec motion&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-130"><a href="direction-tuning.html#cb47-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Spike rate (spikes/sec)&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-131"><a href="direction-tuning.html#cb47-131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb47-132"><a href="direction-tuning.html#cb47-132" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Speed&#39;, &#39;Direction&#39;. You can override
## using the `.groups` argument.</code></pre>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="direction-tuning.html#cb50-1" aria-hidden="true" tabindex="-1"></a>bin10_polar_naive[[<span class="dv">1</span>]]</span></code></pre></div>
<p><img src="_main_files/figure-html/naive-1.png" width="960" /></p>
</div>
<div id="using-40-200ms-initial-transient" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Using 40-200ms (“initial transient”)<a href="direction-tuning.html#using-40-200ms-initial-transient" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="direction-tuning.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## global baseline values, 40-200 msec motion period</span></span>
<span id="cb51-2"><a href="direction-tuning.html#cb51-2" aria-hidden="true" tabindex="-1"></a>bin10_polar_cbit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb51-3"><a href="direction-tuning.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bin10_filelist)) {</span>
<span id="cb51-4"><a href="direction-tuning.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  cbit_df <span class="ot">&lt;-</span></span>
<span id="cb51-5"><a href="direction-tuning.html#cb51-5" aria-hidden="true" tabindex="-1"></a>    bin10_data[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="direction-tuning.html#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&gt;=</span> Static_end <span class="sc">+</span> <span class="fl">0.04</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="direction-tuning.html#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&lt;=</span> Static_end <span class="sc">+</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="direction-tuning.html#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed, Direction, Replicate) <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="direction-tuning.html#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb51-10"><a href="direction-tuning.html#cb51-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(Spike_rate)</span>
<span id="cb51-11"><a href="direction-tuning.html#cb51-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-12"><a href="direction-tuning.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  cbit_360 <span class="ot">&lt;-</span></span>
<span id="cb51-13"><a href="direction-tuning.html#cb51-13" aria-hidden="true" tabindex="-1"></a>    cbit_df <span class="sc">%&gt;%</span></span>
<span id="cb51-14"><a href="direction-tuning.html#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Direction <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-15"><a href="direction-tuning.html#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb51-16"><a href="direction-tuning.html#cb51-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> Speed,</span>
<span id="cb51-17"><a href="direction-tuning.html#cb51-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">Direction =</span> <span class="dv">360</span>,</span>
<span id="cb51-18"><a href="direction-tuning.html#cb51-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Replicate =</span> Replicate,</span>
<span id="cb51-19"><a href="direction-tuning.html#cb51-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> mean_spike_rate)</span>
<span id="cb51-20"><a href="direction-tuning.html#cb51-20" aria-hidden="true" tabindex="-1"></a>  cbit_vecsum_df <span class="ot">&lt;-</span></span>
<span id="cb51-21"><a href="direction-tuning.html#cb51-21" aria-hidden="true" tabindex="-1"></a>    cbit_df <span class="sc">%&gt;%</span></span>
<span id="cb51-22"><a href="direction-tuning.html#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-23"><a href="direction-tuning.html#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="direction-tuning.html#cb51-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb51-25"><a href="direction-tuning.html#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb51-26"><a href="direction-tuning.html#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarize,</span>
<span id="cb51-27"><a href="direction-tuning.html#cb51-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb51-28"><a href="direction-tuning.html#cb51-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb51-29"><a href="direction-tuning.html#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb51-30"><a href="direction-tuning.html#cb51-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb51-31"><a href="direction-tuning.html#cb51-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(<span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb51-32"><a href="direction-tuning.html#cb51-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb51-33"><a href="direction-tuning.html#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb51-34"><a href="direction-tuning.html#cb51-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb51-35"><a href="direction-tuning.html#cb51-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb51-36"><a href="direction-tuning.html#cb51-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb51-37"><a href="direction-tuning.html#cb51-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-38"><a href="direction-tuning.html#cb51-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb51-39"><a href="direction-tuning.html#cb51-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">mean</span>(x),</span>
<span id="cb51-40"><a href="direction-tuning.html#cb51-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">mean</span>(y),</span>
<span id="cb51-41"><a href="direction-tuning.html#cb51-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb51-42"><a href="direction-tuning.html#cb51-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb51-43"><a href="direction-tuning.html#cb51-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">vector_sum =</span> (<span class="fu">atan2</span>(y, x) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi) <span class="sc">%%</span> <span class="dv">360</span>,</span>
<span id="cb51-44"><a href="direction-tuning.html#cb51-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb51-45"><a href="direction-tuning.html#cb51-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-46"><a href="direction-tuning.html#cb51-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb51-47"><a href="direction-tuning.html#cb51-47" aria-hidden="true" tabindex="-1"></a>  cbit_si_df <span class="ot">&lt;-</span></span>
<span id="cb51-48"><a href="direction-tuning.html#cb51-48" aria-hidden="true" tabindex="-1"></a>    cbit_df <span class="sc">%&gt;%</span></span>
<span id="cb51-49"><a href="direction-tuning.html#cb51-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-50"><a href="direction-tuning.html#cb51-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb51-51"><a href="direction-tuning.html#cb51-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb51-52"><a href="direction-tuning.html#cb51-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb51-53"><a href="direction-tuning.html#cb51-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarize,</span>
<span id="cb51-54"><a href="direction-tuning.html#cb51-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb51-55"><a href="direction-tuning.html#cb51-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb51-56"><a href="direction-tuning.html#cb51-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb51-57"><a href="direction-tuning.html#cb51-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb51-58"><a href="direction-tuning.html#cb51-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(<span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb51-59"><a href="direction-tuning.html#cb51-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb51-60"><a href="direction-tuning.html#cb51-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb51-61"><a href="direction-tuning.html#cb51-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> (<span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb51-62"><a href="direction-tuning.html#cb51-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> (<span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb51-63"><a href="direction-tuning.html#cb51-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">mean</span>(mean_spike_rate),</span>
<span id="cb51-64"><a href="direction-tuning.html#cb51-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb51-65"><a href="direction-tuning.html#cb51-65" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-66"><a href="direction-tuning.html#cb51-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb51-67"><a href="direction-tuning.html#cb51-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> <span class="fu">mean</span>(a),</span>
<span id="cb51-68"><a href="direction-tuning.html#cb51-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> <span class="fu">mean</span>(b),</span>
<span id="cb51-69"><a href="direction-tuning.html#cb51-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">mean</span>(c),</span>
<span id="cb51-70"><a href="direction-tuning.html#cb51-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb51-71"><a href="direction-tuning.html#cb51-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb51-72"><a href="direction-tuning.html#cb51-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">si =</span> <span class="fu">sqrt</span>(a <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> b <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> c,</span>
<span id="cb51-73"><a href="direction-tuning.html#cb51-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb51-74"><a href="direction-tuning.html#cb51-74" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-75"><a href="direction-tuning.html#cb51-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb51-76"><a href="direction-tuning.html#cb51-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-77"><a href="direction-tuning.html#cb51-77" aria-hidden="true" tabindex="-1"></a>  cbit_data <span class="ot">&lt;-</span></span>
<span id="cb51-78"><a href="direction-tuning.html#cb51-78" aria-hidden="true" tabindex="-1"></a>    cbit_df <span class="sc">%&gt;%</span></span>
<span id="cb51-79"><a href="direction-tuning.html#cb51-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(cbit_360) <span class="sc">%&gt;%</span></span>
<span id="cb51-80"><a href="direction-tuning.html#cb51-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(cbit_vecsum_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-81"><a href="direction-tuning.html#cb51-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(cbit_si_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-82"><a href="direction-tuning.html#cb51-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate)</span>
<span id="cb51-83"><a href="direction-tuning.html#cb51-83" aria-hidden="true" tabindex="-1"></a>  cbit_max_y <span class="ot">&lt;-</span> <span class="fu">max</span>(cbit_data<span class="sc">$</span>mean_spike_rate)</span>
<span id="cb51-84"><a href="direction-tuning.html#cb51-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-85"><a href="direction-tuning.html#cb51-85" aria-hidden="true" tabindex="-1"></a>  bin10_polar_cbit[[i]] <span class="ot">&lt;-</span></span>
<span id="cb51-86"><a href="direction-tuning.html#cb51-86" aria-hidden="true" tabindex="-1"></a>    cbit_data <span class="sc">%&gt;%</span></span>
<span id="cb51-87"><a href="direction-tuning.html#cb51-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(baseline_summary_df[[i]], <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-88"><a href="direction-tuning.html#cb51-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Direction, <span class="at">y =</span> mean_spike_rate)) <span class="sc">+</span></span>
<span id="cb51-89"><a href="direction-tuning.html#cb51-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(</span>
<span id="cb51-90"><a href="direction-tuning.html#cb51-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Direction,</span>
<span id="cb51-91"><a href="direction-tuning.html#cb51-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> global_baseline <span class="sc">-</span> global_baseline_se,</span>
<span id="cb51-92"><a href="direction-tuning.html#cb51-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> global_baseline <span class="sc">+</span> global_baseline_se</span>
<span id="cb51-93"><a href="direction-tuning.html#cb51-93" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb51-94"><a href="direction-tuning.html#cb51-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;darkgoldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-95"><a href="direction-tuning.html#cb51-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb51-96"><a href="direction-tuning.html#cb51-96" aria-hidden="true" tabindex="-1"></a>                <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="fu">length</span>(polar_directions[[i]])),</span>
<span id="cb51-97"><a href="direction-tuning.html#cb51-97" aria-hidden="true" tabindex="-1"></a>                <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-98"><a href="direction-tuning.html#cb51-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#333132&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-99"><a href="direction-tuning.html#cb51-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(si, <span class="dv">2</span>) , <span class="at">x =</span> <span class="dv">315</span>, <span class="at">y =</span> cbit_max_y <span class="sc">*</span> <span class="fl">1.2</span>),</span>
<span id="cb51-100"><a href="direction-tuning.html#cb51-100" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb51-101"><a href="direction-tuning.html#cb51-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> vector_sum), <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>,</span>
<span id="cb51-102"><a href="direction-tuning.html#cb51-102" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb51-103"><a href="direction-tuning.html#cb51-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="at">direction =</span> <span class="dv">1</span>, <span class="at">start =</span> pi<span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb51-104"><a href="direction-tuning.html#cb51-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb51-105"><a href="direction-tuning.html#cb51-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="dv">270</span>),</span>
<span id="cb51-106"><a href="direction-tuning.html#cb51-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb51-107"><a href="direction-tuning.html#cb51-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">360</span>)</span>
<span id="cb51-108"><a href="direction-tuning.html#cb51-108" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb51-109"><a href="direction-tuning.html#cb51-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb51-110"><a href="direction-tuning.html#cb51-110" aria-hidden="true" tabindex="-1"></a>      <span class="co">#trans = &quot;sqrt&quot;,</span></span>
<span id="cb51-111"><a href="direction-tuning.html#cb51-111" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, cbit_max_y <span class="sc">*</span> <span class="fl">1.2</span>)</span>
<span id="cb51-112"><a href="direction-tuning.html#cb51-112" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb51-113"><a href="direction-tuning.html#cb51-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Speed)) <span class="sc">+</span></span>
<span id="cb51-114"><a href="direction-tuning.html#cb51-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;40-200 ms (initial transient) motion&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-115"><a href="direction-tuning.html#cb51-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Spike rate (spikes/sec)&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-116"><a href="direction-tuning.html#cb51-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb51-117"><a href="direction-tuning.html#cb51-117" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Speed&#39;, &#39;Direction&#39;. You can override
## using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="direction-tuning.html#cb53-1" aria-hidden="true" tabindex="-1"></a>bin10_polar_cbit[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## Warning: Removed 149 rows containing missing values (`geom_smooth()`).</code></pre>
<p><img src="_main_files/figure-html/cb_it-1.png" width="960" /></p>
</div>
<div id="using-1500-3000ms-steady-state" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Using 1500-3000ms (“steady state”)<a href="direction-tuning.html#using-1500-3000ms-steady-state" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="direction-tuning.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## global baseline values, second half of motion period</span></span>
<span id="cb55-2"><a href="direction-tuning.html#cb55-2" aria-hidden="true" tabindex="-1"></a>bin10_polar_cbss <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb55-3"><a href="direction-tuning.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bin10_filelist)) {</span>
<span id="cb55-4"><a href="direction-tuning.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  cbss_df <span class="ot">&lt;-</span></span>
<span id="cb55-5"><a href="direction-tuning.html#cb55-5" aria-hidden="true" tabindex="-1"></a>    bin10_data[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="direction-tuning.html#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&gt;</span> Static_end <span class="sc">+</span> <span class="fl">1.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="direction-tuning.html#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&lt;</span> <span class="fl">4.95</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-8"><a href="direction-tuning.html#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed, Direction, Replicate) <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="direction-tuning.html#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb55-10"><a href="direction-tuning.html#cb55-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(Spike_rate)</span>
<span id="cb55-11"><a href="direction-tuning.html#cb55-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-12"><a href="direction-tuning.html#cb55-12" aria-hidden="true" tabindex="-1"></a>  cbss_360 <span class="ot">&lt;-</span></span>
<span id="cb55-13"><a href="direction-tuning.html#cb55-13" aria-hidden="true" tabindex="-1"></a>    cbss_df <span class="sc">%&gt;%</span></span>
<span id="cb55-14"><a href="direction-tuning.html#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Direction <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-15"><a href="direction-tuning.html#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb55-16"><a href="direction-tuning.html#cb55-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> Speed,</span>
<span id="cb55-17"><a href="direction-tuning.html#cb55-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">Direction =</span> <span class="dv">360</span>,</span>
<span id="cb55-18"><a href="direction-tuning.html#cb55-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Replicate =</span> Replicate,</span>
<span id="cb55-19"><a href="direction-tuning.html#cb55-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> mean_spike_rate)</span>
<span id="cb55-20"><a href="direction-tuning.html#cb55-20" aria-hidden="true" tabindex="-1"></a>  cbss_vecsum_df <span class="ot">&lt;-</span></span>
<span id="cb55-21"><a href="direction-tuning.html#cb55-21" aria-hidden="true" tabindex="-1"></a>    cbss_df <span class="sc">%&gt;%</span></span>
<span id="cb55-22"><a href="direction-tuning.html#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-23"><a href="direction-tuning.html#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb55-24"><a href="direction-tuning.html#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb55-25"><a href="direction-tuning.html#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb55-26"><a href="direction-tuning.html#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarize,</span>
<span id="cb55-27"><a href="direction-tuning.html#cb55-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb55-28"><a href="direction-tuning.html#cb55-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb55-29"><a href="direction-tuning.html#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb55-30"><a href="direction-tuning.html#cb55-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb55-31"><a href="direction-tuning.html#cb55-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(<span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb55-32"><a href="direction-tuning.html#cb55-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb55-33"><a href="direction-tuning.html#cb55-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb55-34"><a href="direction-tuning.html#cb55-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb55-35"><a href="direction-tuning.html#cb55-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb55-36"><a href="direction-tuning.html#cb55-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb55-37"><a href="direction-tuning.html#cb55-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb55-38"><a href="direction-tuning.html#cb55-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb55-39"><a href="direction-tuning.html#cb55-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">mean</span>(x),</span>
<span id="cb55-40"><a href="direction-tuning.html#cb55-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">mean</span>(y),</span>
<span id="cb55-41"><a href="direction-tuning.html#cb55-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb55-42"><a href="direction-tuning.html#cb55-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb55-43"><a href="direction-tuning.html#cb55-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">vector_sum =</span> (<span class="fu">atan2</span>(y, x) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi) <span class="sc">%%</span> <span class="dv">360</span>,</span>
<span id="cb55-44"><a href="direction-tuning.html#cb55-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb55-45"><a href="direction-tuning.html#cb55-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb55-46"><a href="direction-tuning.html#cb55-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb55-47"><a href="direction-tuning.html#cb55-47" aria-hidden="true" tabindex="-1"></a>  cbss_si_df <span class="ot">&lt;-</span></span>
<span id="cb55-48"><a href="direction-tuning.html#cb55-48" aria-hidden="true" tabindex="-1"></a>    cbss_df <span class="sc">%&gt;%</span></span>
<span id="cb55-49"><a href="direction-tuning.html#cb55-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-50"><a href="direction-tuning.html#cb55-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb55-51"><a href="direction-tuning.html#cb55-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb55-52"><a href="direction-tuning.html#cb55-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb55-53"><a href="direction-tuning.html#cb55-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarize,</span>
<span id="cb55-54"><a href="direction-tuning.html#cb55-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb55-55"><a href="direction-tuning.html#cb55-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb55-56"><a href="direction-tuning.html#cb55-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb55-57"><a href="direction-tuning.html#cb55-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb55-58"><a href="direction-tuning.html#cb55-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(<span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb55-59"><a href="direction-tuning.html#cb55-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb55-60"><a href="direction-tuning.html#cb55-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb55-61"><a href="direction-tuning.html#cb55-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> (<span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb55-62"><a href="direction-tuning.html#cb55-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> (<span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb55-63"><a href="direction-tuning.html#cb55-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">mean</span>(mean_spike_rate),</span>
<span id="cb55-64"><a href="direction-tuning.html#cb55-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb55-65"><a href="direction-tuning.html#cb55-65" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb55-66"><a href="direction-tuning.html#cb55-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb55-67"><a href="direction-tuning.html#cb55-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> <span class="fu">mean</span>(a),</span>
<span id="cb55-68"><a href="direction-tuning.html#cb55-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> <span class="fu">mean</span>(b),</span>
<span id="cb55-69"><a href="direction-tuning.html#cb55-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">mean</span>(c),</span>
<span id="cb55-70"><a href="direction-tuning.html#cb55-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb55-71"><a href="direction-tuning.html#cb55-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb55-72"><a href="direction-tuning.html#cb55-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">si =</span> <span class="fu">sqrt</span>(a <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> b <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> c,</span>
<span id="cb55-73"><a href="direction-tuning.html#cb55-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb55-74"><a href="direction-tuning.html#cb55-74" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb55-75"><a href="direction-tuning.html#cb55-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb55-76"><a href="direction-tuning.html#cb55-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-77"><a href="direction-tuning.html#cb55-77" aria-hidden="true" tabindex="-1"></a>  cbss_data <span class="ot">&lt;-</span></span>
<span id="cb55-78"><a href="direction-tuning.html#cb55-78" aria-hidden="true" tabindex="-1"></a>    cbss_df <span class="sc">%&gt;%</span></span>
<span id="cb55-79"><a href="direction-tuning.html#cb55-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(cbss_360) <span class="sc">%&gt;%</span></span>
<span id="cb55-80"><a href="direction-tuning.html#cb55-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(cbss_vecsum_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-81"><a href="direction-tuning.html#cb55-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(cbss_si_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-82"><a href="direction-tuning.html#cb55-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate)</span>
<span id="cb55-83"><a href="direction-tuning.html#cb55-83" aria-hidden="true" tabindex="-1"></a>  cbss_max_y <span class="ot">&lt;-</span> <span class="fu">max</span>(cbss_data<span class="sc">$</span>mean_spike_rate)</span>
<span id="cb55-84"><a href="direction-tuning.html#cb55-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-85"><a href="direction-tuning.html#cb55-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-86"><a href="direction-tuning.html#cb55-86" aria-hidden="true" tabindex="-1"></a>  bin10_polar_cbss[[i]] <span class="ot">&lt;-</span></span>
<span id="cb55-87"><a href="direction-tuning.html#cb55-87" aria-hidden="true" tabindex="-1"></a>    cbss_data <span class="sc">%&gt;%</span></span>
<span id="cb55-88"><a href="direction-tuning.html#cb55-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(baseline_summary_df[[i]], <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-89"><a href="direction-tuning.html#cb55-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Direction, <span class="at">y =</span> mean_spike_rate)) <span class="sc">+</span></span>
<span id="cb55-90"><a href="direction-tuning.html#cb55-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(</span>
<span id="cb55-91"><a href="direction-tuning.html#cb55-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Direction,</span>
<span id="cb55-92"><a href="direction-tuning.html#cb55-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> global_baseline <span class="sc">-</span> global_baseline_se,</span>
<span id="cb55-93"><a href="direction-tuning.html#cb55-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> global_baseline <span class="sc">+</span> global_baseline_se</span>
<span id="cb55-94"><a href="direction-tuning.html#cb55-94" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb55-95"><a href="direction-tuning.html#cb55-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;darkgoldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-96"><a href="direction-tuning.html#cb55-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb55-97"><a href="direction-tuning.html#cb55-97" aria-hidden="true" tabindex="-1"></a>                <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="fu">length</span>(polar_directions[[i]])),</span>
<span id="cb55-98"><a href="direction-tuning.html#cb55-98" aria-hidden="true" tabindex="-1"></a>                <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-99"><a href="direction-tuning.html#cb55-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#333132&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-100"><a href="direction-tuning.html#cb55-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(si, <span class="dv">2</span>) , <span class="at">x =</span> <span class="dv">315</span>, <span class="at">y =</span> cbss_max_y <span class="sc">*</span> <span class="fl">1.2</span>),</span>
<span id="cb55-101"><a href="direction-tuning.html#cb55-101" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb55-102"><a href="direction-tuning.html#cb55-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> vector_sum), <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>,</span>
<span id="cb55-103"><a href="direction-tuning.html#cb55-103" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb55-104"><a href="direction-tuning.html#cb55-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="at">direction =</span> <span class="dv">1</span>, <span class="at">start =</span> pi<span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb55-105"><a href="direction-tuning.html#cb55-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb55-106"><a href="direction-tuning.html#cb55-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="dv">270</span>),</span>
<span id="cb55-107"><a href="direction-tuning.html#cb55-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb55-108"><a href="direction-tuning.html#cb55-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">360</span>)</span>
<span id="cb55-109"><a href="direction-tuning.html#cb55-109" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb55-110"><a href="direction-tuning.html#cb55-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb55-111"><a href="direction-tuning.html#cb55-111" aria-hidden="true" tabindex="-1"></a>      <span class="co">#trans = &quot;sqrt&quot;,</span></span>
<span id="cb55-112"><a href="direction-tuning.html#cb55-112" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, cbss_max_y <span class="sc">*</span> <span class="fl">1.2</span>)</span>
<span id="cb55-113"><a href="direction-tuning.html#cb55-113" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb55-114"><a href="direction-tuning.html#cb55-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Speed)) <span class="sc">+</span></span>
<span id="cb55-115"><a href="direction-tuning.html#cb55-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;1500-3000 ms (steady state) motion&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-116"><a href="direction-tuning.html#cb55-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Spike rate (spikes/sec)&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-117"><a href="direction-tuning.html#cb55-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb55-118"><a href="direction-tuning.html#cb55-118" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Speed&#39;, &#39;Direction&#39;. You can override
## using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="direction-tuning.html#cb57-1" aria-hidden="true" tabindex="-1"></a>bin10_polar_cbss[[<span class="dv">1</span>]]</span></code></pre></div>
<p><img src="_main_files/figure-html/cb_ss-1.png" width="960" /></p>
</div>
<div id="using-0-500-ms-arbitrary-epoch-length" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Using 0-500 ms (arbitrary epoch length)<a href="direction-tuning.html#using-0-500-ms-arbitrary-epoch-length" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="direction-tuning.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## global baseline values, 0-500 msec motion period</span></span>
<span id="cb58-2"><a href="direction-tuning.html#cb58-2" aria-hidden="true" tabindex="-1"></a>bin10_polar_arb <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-3"><a href="direction-tuning.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bin10_filelist)) {</span>
<span id="cb58-4"><a href="direction-tuning.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  arb_df <span class="ot">&lt;-</span></span>
<span id="cb58-5"><a href="direction-tuning.html#cb58-5" aria-hidden="true" tabindex="-1"></a>    bin10_data[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="direction-tuning.html#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&gt;=</span> Static_end <span class="sc">+</span> <span class="fl">0.001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="direction-tuning.html#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time_stand <span class="sc">&lt;=</span> Static_end <span class="sc">+</span> <span class="fl">0.500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="direction-tuning.html#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed, Direction, Replicate) <span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="direction-tuning.html#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb58-10"><a href="direction-tuning.html#cb58-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(Spike_rate)</span>
<span id="cb58-11"><a href="direction-tuning.html#cb58-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-12"><a href="direction-tuning.html#cb58-12" aria-hidden="true" tabindex="-1"></a>  arb_360 <span class="ot">&lt;-</span></span>
<span id="cb58-13"><a href="direction-tuning.html#cb58-13" aria-hidden="true" tabindex="-1"></a>    arb_df <span class="sc">%&gt;%</span></span>
<span id="cb58-14"><a href="direction-tuning.html#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Direction <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-15"><a href="direction-tuning.html#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb58-16"><a href="direction-tuning.html#cb58-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Speed =</span> Speed,</span>
<span id="cb58-17"><a href="direction-tuning.html#cb58-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">Direction =</span> <span class="dv">360</span>,</span>
<span id="cb58-18"><a href="direction-tuning.html#cb58-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Replicate =</span> Replicate,</span>
<span id="cb58-19"><a href="direction-tuning.html#cb58-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_spike_rate =</span> mean_spike_rate)</span>
<span id="cb58-20"><a href="direction-tuning.html#cb58-20" aria-hidden="true" tabindex="-1"></a>  arb_vecsum_df <span class="ot">&lt;-</span></span>
<span id="cb58-21"><a href="direction-tuning.html#cb58-21" aria-hidden="true" tabindex="-1"></a>    arb_df <span class="sc">%&gt;%</span></span>
<span id="cb58-22"><a href="direction-tuning.html#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-23"><a href="direction-tuning.html#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb58-24"><a href="direction-tuning.html#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb58-25"><a href="direction-tuning.html#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb58-26"><a href="direction-tuning.html#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarize,</span>
<span id="cb58-27"><a href="direction-tuning.html#cb58-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb58-28"><a href="direction-tuning.html#cb58-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb58-29"><a href="direction-tuning.html#cb58-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb58-30"><a href="direction-tuning.html#cb58-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb58-31"><a href="direction-tuning.html#cb58-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(<span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb58-32"><a href="direction-tuning.html#cb58-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb58-33"><a href="direction-tuning.html#cb58-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb58-34"><a href="direction-tuning.html#cb58-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb58-35"><a href="direction-tuning.html#cb58-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate,</span>
<span id="cb58-36"><a href="direction-tuning.html#cb58-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb58-37"><a href="direction-tuning.html#cb58-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb58-38"><a href="direction-tuning.html#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb58-39"><a href="direction-tuning.html#cb58-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">mean</span>(x),</span>
<span id="cb58-40"><a href="direction-tuning.html#cb58-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">mean</span>(y),</span>
<span id="cb58-41"><a href="direction-tuning.html#cb58-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb58-42"><a href="direction-tuning.html#cb58-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb58-43"><a href="direction-tuning.html#cb58-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">vector_sum =</span> (<span class="fu">atan2</span>(y, x) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi) <span class="sc">%%</span> <span class="dv">360</span>,</span>
<span id="cb58-44"><a href="direction-tuning.html#cb58-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb58-45"><a href="direction-tuning.html#cb58-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb58-46"><a href="direction-tuning.html#cb58-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb58-47"><a href="direction-tuning.html#cb58-47" aria-hidden="true" tabindex="-1"></a>  arb_si_df <span class="ot">&lt;-</span></span>
<span id="cb58-48"><a href="direction-tuning.html#cb58-48" aria-hidden="true" tabindex="-1"></a>    arb_df <span class="sc">%&gt;%</span></span>
<span id="cb58-49"><a href="direction-tuning.html#cb58-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-50"><a href="direction-tuning.html#cb58-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate) <span class="sc">%&gt;%</span></span>
<span id="cb58-51"><a href="direction-tuning.html#cb58-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(Speed) <span class="sc">%&gt;%</span></span>
<span id="cb58-52"><a href="direction-tuning.html#cb58-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(group_by, Direction) <span class="sc">%&gt;%</span></span>
<span id="cb58-53"><a href="direction-tuning.html#cb58-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarize,</span>
<span id="cb58-54"><a href="direction-tuning.html#cb58-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span> <span class="fu">mean</span>(mean_spike_rate) <span class="sc">-</span> <span class="fu">unique</span>(baseline_summary_df[[i]]<span class="sc">$</span>global_baseline),</span>
<span id="cb58-55"><a href="direction-tuning.html#cb58-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb58-56"><a href="direction-tuning.html#cb58-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mutate,</span>
<span id="cb58-57"><a href="direction-tuning.html#cb58-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_spike_rate =</span></span>
<span id="cb58-58"><a href="direction-tuning.html#cb58-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span>(<span class="fu">min</span>(mean_spike_rate) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> mean_spike_rate <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(mean_spike_rate)),</span>
<span id="cb58-59"><a href="direction-tuning.html#cb58-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> mean_spike_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb58-60"><a href="direction-tuning.html#cb58-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb58-61"><a href="direction-tuning.html#cb58-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> (<span class="fu">sin</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb58-62"><a href="direction-tuning.html#cb58-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> (<span class="fu">cos</span>(Direction <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> mean_spike_rate),</span>
<span id="cb58-63"><a href="direction-tuning.html#cb58-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">mean</span>(mean_spike_rate),</span>
<span id="cb58-64"><a href="direction-tuning.html#cb58-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb58-65"><a href="direction-tuning.html#cb58-65" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb58-66"><a href="direction-tuning.html#cb58-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(summarise,</span>
<span id="cb58-67"><a href="direction-tuning.html#cb58-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> <span class="fu">mean</span>(a),</span>
<span id="cb58-68"><a href="direction-tuning.html#cb58-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> <span class="fu">mean</span>(b),</span>
<span id="cb58-69"><a href="direction-tuning.html#cb58-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">mean</span>(c),</span>
<span id="cb58-70"><a href="direction-tuning.html#cb58-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)) <span class="sc">%&gt;%</span></span>
<span id="cb58-71"><a href="direction-tuning.html#cb58-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(transmute,</span>
<span id="cb58-72"><a href="direction-tuning.html#cb58-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">si =</span> <span class="fu">sqrt</span>(a <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> b <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> c,</span>
<span id="cb58-73"><a href="direction-tuning.html#cb58-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">Speed =</span> <span class="fu">first</span>(Speed)</span>
<span id="cb58-74"><a href="direction-tuning.html#cb58-74" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb58-75"><a href="direction-tuning.html#cb58-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb58-76"><a href="direction-tuning.html#cb58-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-77"><a href="direction-tuning.html#cb58-77" aria-hidden="true" tabindex="-1"></a>  arb_data <span class="ot">&lt;-</span></span>
<span id="cb58-78"><a href="direction-tuning.html#cb58-78" aria-hidden="true" tabindex="-1"></a>    arb_df <span class="sc">%&gt;%</span></span>
<span id="cb58-79"><a href="direction-tuning.html#cb58-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(arb_360) <span class="sc">%&gt;%</span></span>
<span id="cb58-80"><a href="direction-tuning.html#cb58-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(arb_vecsum_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-81"><a href="direction-tuning.html#cb58-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(arb_si_df, <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-82"><a href="direction-tuning.html#cb58-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean_spike_rate)</span>
<span id="cb58-83"><a href="direction-tuning.html#cb58-83" aria-hidden="true" tabindex="-1"></a>  arb_max_y <span class="ot">&lt;-</span> <span class="fu">max</span>(arb_data<span class="sc">$</span>mean_spike_rate)</span>
<span id="cb58-84"><a href="direction-tuning.html#cb58-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-85"><a href="direction-tuning.html#cb58-85" aria-hidden="true" tabindex="-1"></a>  bin10_polar_arb[[i]] <span class="ot">&lt;-</span></span>
<span id="cb58-86"><a href="direction-tuning.html#cb58-86" aria-hidden="true" tabindex="-1"></a>    arb_data <span class="sc">%&gt;%</span></span>
<span id="cb58-87"><a href="direction-tuning.html#cb58-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(baseline_summary_df[[i]], <span class="at">by =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-88"><a href="direction-tuning.html#cb58-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Direction, <span class="at">y =</span> mean_spike_rate)) <span class="sc">+</span></span>
<span id="cb58-89"><a href="direction-tuning.html#cb58-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(</span>
<span id="cb58-90"><a href="direction-tuning.html#cb58-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Direction,</span>
<span id="cb58-91"><a href="direction-tuning.html#cb58-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> global_baseline <span class="sc">-</span> global_baseline_se,</span>
<span id="cb58-92"><a href="direction-tuning.html#cb58-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> global_baseline <span class="sc">+</span> global_baseline_se</span>
<span id="cb58-93"><a href="direction-tuning.html#cb58-93" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb58-94"><a href="direction-tuning.html#cb58-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;darkgoldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-95"><a href="direction-tuning.html#cb58-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb58-96"><a href="direction-tuning.html#cb58-96" aria-hidden="true" tabindex="-1"></a>                <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="fu">length</span>(polar_directions[[i]])),</span>
<span id="cb58-97"><a href="direction-tuning.html#cb58-97" aria-hidden="true" tabindex="-1"></a>                <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-98"><a href="direction-tuning.html#cb58-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#333132&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-99"><a href="direction-tuning.html#cb58-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(si, <span class="dv">2</span>) , <span class="at">x =</span> <span class="dv">315</span>, <span class="at">y =</span> arb_max_y <span class="sc">*</span> <span class="fl">1.2</span>),</span>
<span id="cb58-100"><a href="direction-tuning.html#cb58-100" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb58-101"><a href="direction-tuning.html#cb58-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> vector_sum), <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>,</span>
<span id="cb58-102"><a href="direction-tuning.html#cb58-102" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb58-103"><a href="direction-tuning.html#cb58-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="at">direction =</span> <span class="dv">1</span>, <span class="at">start =</span> pi<span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-104"><a href="direction-tuning.html#cb58-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb58-105"><a href="direction-tuning.html#cb58-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="dv">270</span>),</span>
<span id="cb58-106"><a href="direction-tuning.html#cb58-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb58-107"><a href="direction-tuning.html#cb58-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">360</span>)</span>
<span id="cb58-108"><a href="direction-tuning.html#cb58-108" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb58-109"><a href="direction-tuning.html#cb58-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb58-110"><a href="direction-tuning.html#cb58-110" aria-hidden="true" tabindex="-1"></a>      <span class="co">#trans = &quot;sqrt&quot;,</span></span>
<span id="cb58-111"><a href="direction-tuning.html#cb58-111" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, arb_max_y <span class="sc">*</span> <span class="fl">1.2</span>)</span>
<span id="cb58-112"><a href="direction-tuning.html#cb58-112" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb58-113"><a href="direction-tuning.html#cb58-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Speed)) <span class="sc">+</span></span>
<span id="cb58-114"><a href="direction-tuning.html#cb58-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Spike rate (spikes/sec)&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-115"><a href="direction-tuning.html#cb58-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;0-500 msec motion&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-116"><a href="direction-tuning.html#cb58-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb58-117"><a href="direction-tuning.html#cb58-117" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Speed&#39;, &#39;Direction&#39;. You can override
## using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="direction-tuning.html#cb60-1" aria-hidden="true" tabindex="-1"></a>bin10_polar_arb[[<span class="dv">1</span>]] </span></code></pre></div>
<pre><code>## Warning: Removed 17 rows containing missing values (`geom_smooth()`).</code></pre>
<p><img src="_main_files/figure-html/arb-1.png" width="960" /></p>
</div>
<div id="construct-a-multi-panel-plot" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Construct a multi-panel plot<a href="direction-tuning.html#construct-a-multi-panel-plot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can use the handy <code>cowplot</code> package to construct a multi-panel plot.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="direction-tuning.html#cb62-1" aria-hidden="true" tabindex="-1"></a>cow_polar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-2"><a href="direction-tuning.html#cb62-2" aria-hidden="true" tabindex="-1"></a>cow_polar[[i]] <span class="ot">&lt;-</span></span>
<span id="cb62-3"><a href="direction-tuning.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(bin10_polar_naive[[i]],</span>
<span id="cb62-4"><a href="direction-tuning.html#cb62-4" aria-hidden="true" tabindex="-1"></a>            bin10_polar_cbit[[i]],</span>
<span id="cb62-5"><a href="direction-tuning.html#cb62-5" aria-hidden="true" tabindex="-1"></a>            bin10_polar_cbss[[i]],</span>
<span id="cb62-6"><a href="direction-tuning.html#cb62-6" aria-hidden="true" tabindex="-1"></a>            bin10_polar_arb[[i]],</span>
<span id="cb62-7"><a href="direction-tuning.html#cb62-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 149 rows containing missing values (`geom_smooth()`).</code></pre>
<pre><code>## Warning: Removed 17 rows containing missing values (`geom_smooth()`).</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="direction-tuning.html#cb65-1" aria-hidden="true" tabindex="-1"></a>cow_polar[[<span class="dv">1</span>]]</span></code></pre></div>
<p><img src="_main_files/figure-html/polar_cows-1.png" width="960" /></p>
<p>This plot can also be written directly to <code>PDF</code>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="direction-tuning.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cow_polar)) {</span>
<span id="cb66-2"><a href="direction-tuning.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf</span>(<span class="at">file =</span></span>
<span id="cb66-3"><a href="direction-tuning.html#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;./plot_pdfs/&quot;</span>,</span>
<span id="cb66-4"><a href="direction-tuning.html#cb66-4" aria-hidden="true" tabindex="-1"></a>               bin10_basenames[i],</span>
<span id="cb66-5"><a href="direction-tuning.html#cb66-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;_polar_set.pdf&quot;</span>),</span>
<span id="cb66-6"><a href="direction-tuning.html#cb66-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">22</span>, <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb66-7"><a href="direction-tuning.html#cb66-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">pagecentre =</span> <span class="cn">TRUE</span>, <span class="at">colormodel =</span> <span class="st">&quot;srgb&quot;</span>)</span>
<span id="cb66-8"><a href="direction-tuning.html#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(cow_polar[[i]])</span>
<span id="cb66-9"><a href="direction-tuning.html#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb66-10"><a href="direction-tuning.html#cb66-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="raster-and-mean-spike-rate-plots.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatiotemporal-tuning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"highlight": "tango",
"info": true
});
});
</script>

</body>

</html>
