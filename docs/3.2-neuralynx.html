<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.2 Neuralynx | Fundamental plots for electrophysiological data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="<p>A walkthrough on how to produce fundamental plots from electrophysiological
data. Developed by the Alshuler Lab at the University of British Columbia.</p>" />
<meta name="github-repo" content="flightlab/ephys_fundamental_plots" />

<meta name="author" content="Vikram B. Baliga" />

<meta name="date" content="2023-02-28" />


<meta name="description" content="<p>A walkthrough on how to produce fundamental plots from electrophysiological
data. Developed by the Alshuler Lab at the University of British Columbia.</p>">

<title>3.2 Neuralynx | Fundamental plots for electrophysiological data</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#about" id="toc-about"><span class="toc-section-number">1</span> About</a>
<ul>
<li><a href="citation.html#citation" id="toc-citation">Citation</a></li>
<li><a href="license.html#license" id="toc-license">License</a></li>
</ul></li>
<li class="has-sub"><a href="2-preface.html#preface" id="toc-preface"><span class="toc-section-number">2</span> Preface</a>
<ul>
<li><a href="2.1-r-packages-versioning.html#r-packages-versioning" id="toc-r-packages-versioning"><span class="toc-section-number">2.1</span> R packages &amp; versioning</a></li>
<li><a href="2.2-not_in.html#not_in" id="toc-not_in"><span class="toc-section-number">2.2</span> <code>%not_in%</code></a></li>
</ul></li>
<li class="has-sub"><a href="3-spike-sorting.html#spike-sorting" id="toc-spike-sorting"><span class="toc-section-number">3</span> Spike sorting</a>
<ul>
<li><a href="3.1-spike2.html#spike2" id="toc-spike2"><span class="toc-section-number">3.1</span> Spike2</a></li>
<li><a href="3.2-neuralynx.html#neuralynx" id="toc-neuralynx"><span class="toc-section-number">3.2</span> Neuralynx</a></li>
</ul></li>
<li class="has-sub"><a href="4-raw-data-and-spike-sorted-traces.html#raw-data-and-spike-sorted-traces" id="toc-raw-data-and-spike-sorted-traces"><span class="toc-section-number">4</span> Raw data and spike sorted traces</a>
<ul>
<li><a href="4.1-including-plots.html#including-plots" id="toc-including-plots"><span class="toc-section-number">4.1</span> Including Plots</a></li>
</ul></li>
<li class="has-sub"><a href="5-data-wrangling.html#data-wrangling" id="toc-data-wrangling"><span class="toc-section-number">5</span> Data wrangling</a>
<ul>
<li class="has-sub"><a href="5.1-import-example-file-and-metadata.html#import-example-file-and-metadata" id="toc-import-example-file-and-metadata"><span class="toc-section-number">5.1</span> Import example file and metadata</a>
<ul>
<li><a href="5.1-import-example-file-and-metadata.html#identify-files-to-import" id="toc-identify-files-to-import"><span class="toc-section-number">5.1.1</span> Identify files to import</a></li>
<li><a href="5.1-import-example-file-and-metadata.html#data-import-and-preliminary-labeling" id="toc-data-import-and-preliminary-labeling"><span class="toc-section-number">5.1.2</span> Data import and preliminary labeling</a></li>
</ul></li>
<li><a href="5.2-organizing-replicates-required-and-binning-optional.html#organizing-replicates-required-and-binning-optional" id="toc-organizing-replicates-required-and-binning-optional"><span class="toc-section-number">5.2</span> Organizing replicates (required) and binning (optional)</a></li>
<li><a href="5.3-data-export.html#data-export" id="toc-data-export"><span class="toc-section-number">5.3</span> Data export</a></li>
</ul></li>
<li class="has-sub"><a href="6-raster-and-mean-spike-rate-plots.html#raster-and-mean-spike-rate-plots" id="toc-raster-and-mean-spike-rate-plots"><span class="toc-section-number">6</span> Raster and mean spike rate plots</a>
<ul>
<li><a href="6.1-including-plots-1.html#including-plots-1" id="toc-including-plots-1"><span class="toc-section-number">6.1</span> Including Plots</a></li>
</ul></li>
<li class="has-sub"><a href="7-spatiotemporal-tuning.html#spatiotemporal-tuning" id="toc-spatiotemporal-tuning"><span class="toc-section-number">7</span> Spatiotemporal tuning</a>
<ul>
<li><a href="7.1-including-plots-2.html#including-plots-2" id="toc-including-plots-2"><span class="toc-section-number">7.1</span> Including Plots</a></li>
</ul></li>
<li class="has-sub"><a href="8-histological-verification.html#histological-verification" id="toc-histological-verification"><span class="toc-section-number">8</span> Histological verification</a>
<ul>
<li><a href="8.1-including-plots-3.html#including-plots-3" id="toc-including-plots-3"><span class="toc-section-number">8.1</span> Including Plots</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="neuralynx" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Neuralynx</h2>
<p>Written by Eric Press, November 11, 2022</p>
<ol style="list-style-type: decimal">
<li><p>Spike sorting database:</p>
<ol style="list-style-type: decimal">
<li>Check the column labelled <code>Sorting status</code> to find days of recording
that are <code>cued</code> meaning they are ready to be sorted. Recordings are cued
for spike sorting once information about the recording has been added to
the database. This includes observations from the day’s recording,
whether the electrode position was moved from the previous recording,
and the stimulus condition for each recording. The recordings are stored
at the following location and are named/organized by date and time of
recording:<br />
<code>Computer/LaCie (D:)/Eric’s data/nlx_recordings</code></li>
</ol></li>
<li><p>Filtering the raw traces (CSCs):</p>
<ol style="list-style-type: decimal">
<li><p>Use the <code>NlxCSCFiltering</code> tool on any Windows machine to run a band-pass
filter on input <code>CSC</code> files.</p></li>
<li><p>Choose all the <code>CSC</code> files for a given recording, change the <code>PreAppend</code>
field to <code>spfilt</code>, which stands for spike-filtered and adjust the <code>DSP</code>
filtering fields to match the image to the right. This selects for
frequencies in the raw traces where spikes will be found, but removes
low frequency (LFP) and high frequency components of the traces.</p></li>
</ol></li>
</ol>
<div class="figure">
<img src="source_images/sec3.2.1_nix_csc_filter.png" alt="" />
<p class="caption">Nix csc filter</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li><p>Examine the filtered traces:</p>
<ol style="list-style-type: decimal">
<li>Take a closer look at the filtered traces (Open in <code>Neuraview</code> on any
Windows machine) and determine which channels are likely to have
isolatable spikes and how many distinct spikes there might be. It helps
to keep <code>Neuraview</code> open when setting thresholds in the next step.</li>
</ol></li>
<li><p>Spike detection from filtered traces:</p>
<ol style="list-style-type: decimal">
<li><p>Use the <code>CSCSpikeExtractor</code> tool on any Windows machine to detect spikes
above or below a given µV) threshold. The units displayed in the program
will be AdBitVolts which are simply 10.92x from the µV value.</p></li>
<li><p>Based on the filtered traces, within <code>CSCSpikeExtractor</code>, set the spike
extraction properties (<code>Spike Extraction -&gt; Properties</code> OR <code>Ctrl+P</code>) as
shown above. The <code>Extraction Value</code> is set to 10.92x the µV you chose by
viewing the filtered traces.</p></li>
<li><p>Press <code>Ctrl+S</code> to extract spikes from the selected file at the desired
settings. The resulting file will be placed in the <code>extracted spikes</code>
filter on the <code>Desktop</code>.</p></li>
<li><p>Create subfolders in the recording folder for each threshold and move
the extracted spikes at each threshold into the appropriate folder.
These spike-detected files will be used for spike sorting in the next
step.</p></li>
<li><p><strong>If it helps with detecting real spike waveforms while eliminating
noise, run recordings through spike detection at multiple threshold
(positive or negative) such that only all putative neurons are accounted
for a minimal noise is detected.</strong></p></li>
</ol></li>
</ol>
<div class="figure">
<img src="source_images/sec3.2.2_spike_extraction_properties.png" alt="" />
<p class="caption">Spike extraction
properties</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li><p>Spike sorting:</p>
<ol style="list-style-type: decimal">
<li><p>Open the extracted spikes in <code>Spikesort3D</code> on either the Neuralynx
machine or another Windows machine that has an active <code>SpikeSort3D</code>
licence. You can also use <code>TeamViewer</code> to control the Neuralynx machine
but this works much better with another Windows machine.</p></li>
<li><p>Press OK when the feature selection window appears. If you want to
select alternate features to display, select them from the list
provided. Sometimes it can be helpful to use PCA1 – 3 in isolating
neurons but often it makes things more challenging.</p></li>
<li><p>Using the 3D Plot, examine the clustering of spikes. Follow the image
below to aid in interacting with the 3D plot (MB = the scroll wheel
button i.e. middle mouse button). You can change the features displayed
on each axis with <code>Q/W</code>, <code>A/S</code>, and <code>Z/X</code> respectively. Also, <code>Ctrl+P</code>
brings up a window that allows you to change the size and opacity of
points on the plot (I find <code>size = 2</code>, <code>alpha = 0.5</code> works well to
improve visual definition of the clusters). If distinct clusters are
difficult to see, find the combination of 3 features that produces the
most noticeable clustering or the greatest spread of points in the
space. The features displayed in the 3D plot are shown at the top left
of the plot (i.e. X(3) Height # # # #). Use those features for the
next step. <img src="source_images/sec3.2.3_3d_plot_movement.png" alt="3D plot movement and interaction" /></p></li>
<li><p>Run <code>KlustaKwik</code> (<code>Cluster → Autocluster using KlustaKwik</code>) and select
the 3 features that generate the most clearly separable clusters on the
3D view – often, the first 3 (<code>Peak</code>, <code>Valley</code>, <code>Energy</code>) do a decent
job. Change the <code>MaxPossibleClusters</code> to <code>10</code> before pressing <code>Run</code>. The
remaining settings should match the image below. <img src="source_images/sec3.2.4_klustakwik.png" alt="KlustaKwik interface" /></p></li>
<li><p>Following calculations, use the <code>Waveform</code> window and the 3D plot to
group the distinct clusters into what you believe are waveforms produced
by distinct neurons. Use the number keys to highlight distinct clusters
and <code>Ctrl+M</code> to merge clusters together. <code>Ctrl+C</code> copies the selected
cluster and can be used to split a cluster into 2 if you believe
portions of the cluster belong to distinct putative neurons. This step
takes some practice. You can use <code>Ctrl+Z</code> to undo only one move.
Otherwise, you may need to exit without saving and start again at
step 4. Save with <code>Ctrl+S</code> often and click OK to overwrite the file.</p></li>
<li><p>Once you are satisfied with the waveforms left, note how many there are,
and whether it seems possible that some of the groups belong to the same
neuron. Consider what you know about excitable membranes to make these
decisions. Fill out the <code>Spike Sorting Database</code> with the information
used to reach this point. This includes, the threshold(s), # of
clusters, # of putative neurons (often 1 less than the # of clusters
because it would be a stretch to include the smallest amplitude waveform
as a distinct, separable neuron), and any else to note from performing
sorting.</p></li>
<li><p>Save each cluster to its own spike file
(<code>File → Save Multiple Spike Files</code>)</p></li>
<li><p>Open the separate spike files you just created, along with the original
filtered trace in <code>Neuraview</code>. Scroll along the recording and examine if
the sorting you performed seems believable. Do the spikes in different
rows really seem like they’re different in the filtered trace? Do some
spikes not seem like real spikes? If anything seems amiss, make the
appropriate merges in <code>SpikeSort3D</code> before proceding.</p></li>
<li><p>Export the relevant data from the sorting. Perform the following:</p>
<ol style="list-style-type: decimal">
<li><p><code>File → Save ASCII Timestamp Files</code></p></li>
<li><p><code>File → Save Multiple Spike Files</code></p></li>
<li><p><code>File → Save ASCII Avg Waveforms</code></p></li>
<li><p>Also, save the file itself with <code>Ctrl+S</code></p></li>
</ol></li>
<li><p>Lastly, bring up all the waveforms together on the waveform plot. Take a
screenshot and save it to the folder where the extracted spikes (and now
timestamps files) are stored.</p></li>
</ol></li>
<li><p>Moving sorted files to other locations:</p>
<ol style="list-style-type: decimal">
<li><p>Once a chunk of recordings have been sorted, copy/paste the entire
recording file to Eric’s orange 1TB storage drive (Lacie). Place them in
the following folder:</p>
<p><code>Eric's data/sorted_recordings</code></p></li>
</ol></li>
</ol>

</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="3.1-spike2.html"><button class="btn btn-default">Previous</button></a>
<a href="4-raw-data-and-spike-sorted-traces.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
